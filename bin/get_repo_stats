#!/bin/bash
# 
#   get_repo_stats: show directory name, branch, last commit, date, and author
# 
# --- Start standard header ----
function getdname(){
   local __DIRN=`dirname "$1"`
   if [ "$__DIRN" = "." ] ; then
      __DIRN=$PWD;
   else
      if [ ${__DIRN:0:1} != "/" ] ; then
         if [ ${__DIRN:0:2} == ".." ] ; then
               __DIRN=`dirname $PWD`/${__DIRN:3}
         else
            if [ ${__DIRN:0:1} = "." ] ; then
               __DIRN=$PWD/${__DIRN:2}
            else
               __DIRN=$PWD/$__DIRN
            fi
         fi
      fi
   fi
   echo $__DIRN
}
thisdir=$(getdname $0)
[ ! -L "$0" ] || thisdir=$(getdname `readlink "$0"`)
. $thisdir/aomp_common_vars
# --- end standard header ----

repocmd="$AOMP_REPOS/.bin/repo"
if [ ! -f $repocmd ] ; then
   echo "ERROR: The repo command was not found at $repocmd"
   echo "       It is likely that directory $AOMP_REPOS does not "
   echo "       contain a set of repos managed by repo command."
   exit 1
fi
echo "REPO DIRECTORY: $AOMP_REPOS"
tmpfile=/tmp/repostats$$
$repocmd forall -g unlocked -c $thisdir/repo_forall_cmds list | sort >$tmpfile
$repocmd  forall -g revlocked -c $thisdir/repo_forall_cmds list >>$tmpfile
cat $tmpfile
rm $tmpfile
